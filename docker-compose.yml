version: '3.8'

services:
  moli-door:
    build: .
    image: bs10081/moli-door:dev
    container_name: moli-door-system
    restart: unless-stopped

    # 使用精確的 capabilities 取代 privileged
    cap_add:
      - SYS_RAWIO  # GPIO 存取

    # Device mappings
    devices:
      - /dev/gpiomem:/dev/gpiomem  # GPIO access
      - /dev/input:/dev/input      # RFID reader access

    # Network mode: host（不需要 ports 映射）
    network_mode: host

    # Volume for persistent database
    volumes:
      - ./data:/app/data

    # Use .env file for environment variables
    env_file:
      - .env

    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
