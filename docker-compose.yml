version: '3.8'

services:
  moli-door:
    build: .
    image: bs10081/moli-door:dev
    container_name: moli-door-system
    restart: unless-stopped
    
    # Privileged mode for GPIO and device access
    privileged: true
    
    # Device mappings
    devices:
      - /dev/gpiomem:/dev/gpiomem  # GPIO access
      - /dev/input:/dev/input      # RFID reader access
    
    # Port mapping (FastAPI port 8000)
    ports:
      - "8000:8000"
    
    # Volume for persistent database
    volumes:
      - ./data:/app/data
      - /dev:/dev  # Full device access
    
    # Use .env file for environment variables
    env_file:
      - .env
    
    # Network mode: host for better device access
    network_mode: host
    
    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
